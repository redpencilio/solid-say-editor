<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/selectors/predicate-selector.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/selectors/predicate-selector.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { getOwner } from '@ember/application';
import { action } from '@ember/object';
import { inject as service } from '@ember/service';
import Component from '@glimmer/component';
import { tracked } from '@glimmer/tracking';
import rdflib from 'ember-rdflib';
import { RDFA_SERIALIZER } from '../../utils/serializers/rdfa-serializer';
const RDFS = rdflib.Namespace("http://www.w3.org/2000/01/rdf-schema#")

/**
 * Component responsible for rendering a list of selectable predicates and for fetching predicates from a store for a specific subject
 *
 * @class PredicateSelectorComponent
 * @extends Ember.Component
 * 
 * @property {Ember.Service} storeCommunicator
 * @property {Ember.Service} profile
 * @property {Boolean} popup
 * @property {Set} selectedQuads
 * @property {Boolean} isLoading
 */
export default class PredicateSelectorComponent extends Component {
  @service("model/store-communicator") storeCommunicator;
  @service profile;
  @tracked popup = false;
  selectedQuads = new Set();
  @tracked
  isLoading = true; 


  @tracked
  attributes = {};
  @tracked
  pred_metadata = {};

  owner = getOwner(this);
  serializer = this.owner.lookup(RDFA_SERIALIZER);

  /**
  * Fetches a list of triples from the store for the given subject, also fetches metadata for the predicates of the triples
  * Triples are grouped per predicate
  *
  * @method resetAttributes
  *
  * @memberof PredicateSelectorComponent
  * @public
  */
  @action
  async resetAttributes() {
    this.isLoading = true; 
    let quads = await this.storeCommunicator.fetchTriples(this.args.subject, undefined, this.args.graph);
    let predicateObjs = {};
    let metadata = {};
    for (const quad of quads) {
      if (quad.predicate.value in predicateObjs) {
        predicateObjs[quad.predicate.value].push(quad);
      } else {
        const result = await this.storeCommunicator.fetchResourceMetaData(quad.predicate);
        metadata[quad.predicate.value] = result;
        predicateObjs[quad.predicate.value] = [quad];
      }

    }
    this.pred_metadata = metadata;
    this.attributes = predicateObjs;

    this.isLoading= false; 
  }

  /**
   * Generates and inserts rdfa-tags for the selected triples and their metadata for the given subject
   *
   * @method insert
   *
   * @memberof PredicateSelectorComponent
   * @public
   */
  @action
  async insert() {
    const rdfa = this.serializer.serializeQuads([...this.selectedQuads], this.pred_metadata);
    this.args.onClose(rdfa);
  }

  @action
  onSelect(quad) {
    if (this.selectedQuads.has(quad)) {
      this.selectedQuads.delete(quad);
    } else {
      this.selectedQuads.add(quad);
    }
  }


   /**
   * Method that is called when a triple has been created, this will add the triple to predicate-selection-list
   * Fetches metadata of the predicate of the triple if necessary
   *
   * @method insert
   *
   * @memberof PredicateSelectorComponent
   * 
   * @public
   */
  @action
  async addPredicate(quad) {
    let predicateObjs = { ...this.attributes };
    let metadata = { ...this.pred_metadata };
    if (quad.predicate.value in predicateObjs) {
      predicateObjs[quad.predicate.value].pushObject(quad);
    } else {
      const result = await this.storeCommunicator.fetchResourceMetaData(quad.predicate);
      metadata[quad.predicate.value] = result;
      predicateObjs[quad.predicate.value] = [quad];
    }
    this.pred_metadata = metadata;
    this.attributes = predicateObjs;
  }

  @action
  onContentClick() {
    event.stopPropagation();
  }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="EditInEditorBlockHandler.html">EditInEditorBlockHandler</a></li><li><a href="editor-say-solid-plugin.html">editor-say-solid-plugin</a></li><li><a href="FileCreateModalComponent.html">FileCreateModalComponent</a></li><li><a href="FileListComponent.html">FileListComponent</a></li><li><a href="FileSelectorComponent.html">FileSelectorComponent</a></li><li><a href="LoginButtonComponent.html">LoginButtonComponent</a></li><li><a href="ModalComponent.html">ModalComponent</a></li><li><a href="ModalsVocabDropdownComponent.html">ModalsVocabDropdownComponent</a></li><li><a href="module.exports.html">exports</a></li><li><a href="PredicateSelectorComponent.html">PredicateSelectorComponent</a></li><li><a href="ProfileHeaderComponent.html">ProfileHeaderComponent</a></li><li><a href="SaveResetBlockHandler.html">SaveResetBlockHandler</a></li><li><a href="SaySolidFetchCard.html">SaySolidFetchCard</a></li><li><a href="SaySolidFilesCard.html">SaySolidFilesCard</a></li><li><a href="SaySolidLoginCard.html">SaySolidLoginCard</a></li><li><a href="SaySolidSaveResetCard.html">SaySolidSaveResetCard</a></li><li><a href="SaySolidTypesCard.html">SaySolidTypesCard</a></li><li><a href="SubjectCreateModalComponent.html">SubjectCreateModalComponent</a></li><li><a href="SubjectSelectorComponent.html">SubjectSelectorComponent</a></li><li><a href="TripleCreateModalComponent.html">TripleCreateModalComponent</a></li><li><a href="TripleFormComponent.html">TripleFormComponent</a></li><li><a href="TypeSelectorComponent.html">TypeSelectorComponent</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_serializeToBody">_serializeToBody</a></li><li><a href="global.html#_serializeToHead">_serializeToHead</a></li><li><a href="global.html#_serializeToTail">_serializeToTail</a></li><li><a href="global.html#addQuadToCache">addQuadToCache</a></li><li><a href="global.html#card">card</a></li><li><a href="global.html#execute">execute</a></li><li><a href="global.html#extractUuid">extractUuid</a></li><li><a href="global.html#fetcherReset">fetcherReset</a></li><li><a href="global.html#fetchProfileInfo">fetchProfileInfo</a></li><li><a href="global.html#fetchResourceMetaData">fetchResourceMetaData</a></li><li><a href="global.html#fetchSubjectsByGraph">fetchSubjectsByGraph</a></li><li><a href="global.html#fetchTriples">fetchTriples</a></li><li><a href="global.html#fetchTypeIndexes">fetchTypeIndexes</a></li><li><a href="global.html#fetchTypes">fetchTypes</a></li><li><a href="global.html#fromRDFa">fromRDFa</a></li><li><a href="global.html#getGraph">getGraph</a></li><li><a href="global.html#getGraphByType">getGraphByType</a></li><li><a href="global.html#getGraphByType_TypeIndex">getGraphByType_TypeIndex</a></li><li><a href="global.html#getType">getType</a></li><li><a href="global.html#handle">handle</a></li><li><a href="global.html#handleClose">handleClose</a></li><li><a href="global.html#persist">persist</a></li><li><a href="global.html#processNode">processNode</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#save">save</a></li><li><a href="global.html#scope">scope</a></li><li><a href="global.html#serializeQuads">serializeQuads</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Wed Aug 12 2020 14:41:10 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
